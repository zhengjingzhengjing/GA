(window.webpackJsonp=window.webpackJsonp||[]).push([[31],{359:function(n,s,a){"use strict";a.r(s);var e=a(3),t=Object(e.a)({},(function(){var n=this,s=n.$createElement,a=n._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":n.$parent.slotKey}},[a("h2",{attrs:{id:"调取登录接口"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#调取登录接口"}},[n._v("#")]),n._v(" 调取登录接口")]),n._v(" "),a("p",[n._v("首先明确一下要做到事情")]),n._v(" "),a("p",[n._v("在前后端完全分离的情况下，Vue项目中实现token验证大致思路如下：")]),n._v(" "),a("p",[n._v("1、第一次登录的时候，前端调后端的登陆接口，发送用户名和密码")]),n._v(" "),a("p",[n._v("2、后端收到请求，验证用户名和密码，验证成功，就给前端返回一个token")]),n._v(" "),a("p",[n._v("3、前端拿到token，将token存储到localStorage和vuex中，并跳转路由页面")]),n._v(" "),a("p",[n._v("4、前端每次跳转路由，就判断 localStroage 中有无 token ，没有就跳转到登录页面，有则跳转到对应路由页面")]),n._v(" "),a("p",[n._v("5、每次调后端接口，都要在请求头中加token")]),n._v(" "),a("p",[n._v("6、后端判断请求头中有无token，有token，就拿到token并验证token，验证成功就返回数据，验证失败（例如：token过期）就返回401，请求头中没有token也返回401")]),n._v(" "),a("p",[n._v("7、如果前端拿到状态码为401，就清除token信息并跳转到登录页面")]),n._v(" "),a("p",[n._v("调取登录接口成功，会在回调函数中将token存储到localStorage和vuex中")]),n._v(" "),a("p",[a("img",{attrs:{src:"https://upload-images.jianshu.io/upload_images/20357186-c66296119071df59.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/155/format/webp",alt:""}})]),n._v(" "),a("p",[n._v("login.vue")]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v("<template>\n  <div>\n    <input type=\"text\" v-model=\"loginForm.username\" placeholder=\"用户名\"/>\n    <input type=\"text\" v-model=\"loginForm.password\" placeholder=\"密码\"/>\n    <button @click=\"login\">登录</button>\n  </div>\n</template>\n\nexport default {\n  data () {\n    return {\n      loginForm: {\n        username: '',\n        password: ''      }\n    };\n  },\n\n  methods: {\n    ...mapMutations(['changeLogin']),\n    login () {\n      let _this =this;                  \n      //判读账号密码是否输入，没有则alert 出来\n      if(this.loginForm.username === '' ||this.loginForm.password === '') {             \n        alert('账号或密码不能为空');\n      } else {\n        this.axios({\n          method: 'post',\n          url: '/user/login',\n          data: _this.loginForm\n        }).then(res => {\n          console.log(res.data);\n          _this.userToken = 'Bearer ' + res.data.data.body.token;\n          // 将用户token保存到vuex中          \n          _this.changeLogin({ Authorization: _this.userToken });\n          _this.$router.push('/home');\n          alert('登陆成功');\n        }).catch(error => {\n          alert('账号或密码错误');\n          console.log(error);\n        });\n      }\n    }\n  }\n}\n")])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br"),a("span",{staticClass:"line-number"},[n._v("6")]),a("br"),a("span",{staticClass:"line-number"},[n._v("7")]),a("br"),a("span",{staticClass:"line-number"},[n._v("8")]),a("br"),a("span",{staticClass:"line-number"},[n._v("9")]),a("br"),a("span",{staticClass:"line-number"},[n._v("10")]),a("br"),a("span",{staticClass:"line-number"},[n._v("11")]),a("br"),a("span",{staticClass:"line-number"},[n._v("12")]),a("br"),a("span",{staticClass:"line-number"},[n._v("13")]),a("br"),a("span",{staticClass:"line-number"},[n._v("14")]),a("br"),a("span",{staticClass:"line-number"},[n._v("15")]),a("br"),a("span",{staticClass:"line-number"},[n._v("16")]),a("br"),a("span",{staticClass:"line-number"},[n._v("17")]),a("br"),a("span",{staticClass:"line-number"},[n._v("18")]),a("br"),a("span",{staticClass:"line-number"},[n._v("19")]),a("br"),a("span",{staticClass:"line-number"},[n._v("20")]),a("br"),a("span",{staticClass:"line-number"},[n._v("21")]),a("br"),a("span",{staticClass:"line-number"},[n._v("22")]),a("br"),a("span",{staticClass:"line-number"},[n._v("23")]),a("br"),a("span",{staticClass:"line-number"},[n._v("24")]),a("br"),a("span",{staticClass:"line-number"},[n._v("25")]),a("br"),a("span",{staticClass:"line-number"},[n._v("26")]),a("br"),a("span",{staticClass:"line-number"},[n._v("27")]),a("br"),a("span",{staticClass:"line-number"},[n._v("28")]),a("br"),a("span",{staticClass:"line-number"},[n._v("29")]),a("br"),a("span",{staticClass:"line-number"},[n._v("30")]),a("br"),a("span",{staticClass:"line-number"},[n._v("31")]),a("br"),a("span",{staticClass:"line-number"},[n._v("32")]),a("br"),a("span",{staticClass:"line-number"},[n._v("33")]),a("br"),a("span",{staticClass:"line-number"},[n._v("34")]),a("br"),a("span",{staticClass:"line-number"},[n._v("35")]),a("br"),a("span",{staticClass:"line-number"},[n._v("36")]),a("br"),a("span",{staticClass:"line-number"},[n._v("37")]),a("br"),a("span",{staticClass:"line-number"},[n._v("38")]),a("br"),a("span",{staticClass:"line-number"},[n._v("39")]),a("br"),a("span",{staticClass:"line-number"},[n._v("40")]),a("br"),a("span",{staticClass:"line-number"},[n._v("41")]),a("br"),a("span",{staticClass:"line-number"},[n._v("42")]),a("br"),a("span",{staticClass:"line-number"},[n._v("43")]),a("br"),a("span",{staticClass:"line-number"},[n._v("44")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://upload-images.jianshu.io/upload_images/20357186-ebad48788cf52723.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/316/format/webp",alt:""}})]),n._v(" "),a("p",[n._v("在store文件夹下的index.js  添加 token")]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v("import Vue from 'vue';\nimport Vuex from 'vuex';\nVue.use(Vuex);\nconst store = new Vuex.Store({\n  state: {\n    // 存储token\n    Authorization: localStorage.getItem('Authorization') ? localStorage.getItem('Authorization') : ''\n  },\n  mutations: {\n    // 修改token，并将token存入localStorage\n    changeLogin (state, user) {\n      state.Authorization = user.Authorization\n      localStorage.setItem('Authorization', user.Authorization);\n    }\n  }\n});\n\nexport default store\n")])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br"),a("span",{staticClass:"line-number"},[n._v("6")]),a("br"),a("span",{staticClass:"line-number"},[n._v("7")]),a("br"),a("span",{staticClass:"line-number"},[n._v("8")]),a("br"),a("span",{staticClass:"line-number"},[n._v("9")]),a("br"),a("span",{staticClass:"line-number"},[n._v("10")]),a("br"),a("span",{staticClass:"line-number"},[n._v("11")]),a("br"),a("span",{staticClass:"line-number"},[n._v("12")]),a("br"),a("span",{staticClass:"line-number"},[n._v("13")]),a("br"),a("span",{staticClass:"line-number"},[n._v("14")]),a("br"),a("span",{staticClass:"line-number"},[n._v("15")]),a("br"),a("span",{staticClass:"line-number"},[n._v("16")]),a("br"),a("span",{staticClass:"line-number"},[n._v("17")]),a("br"),a("span",{staticClass:"line-number"},[n._v("18")]),a("br")])]),a("h2",{attrs:{id:"二，配置-路由导航守卫"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二，配置-路由导航守卫"}},[n._v("#")]),n._v(" 二，配置  路由导航守卫")]),n._v(" "),a("p",[n._v("router文件夹下的index.js")]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v("import Vue from 'vue';\nimport Router from 'vue-router';\nimport login from '@/components/login';\nimport home from '@/components/home';\nVue.use(Router);\nconst router = new Router({\n  routes: [\n    {\n      path: '/',\n      redirect: '/login'\n    },\n    {\n      path: '/login',\n      name: 'login',\n      component: login\n    },\n    {\n      path: '/home',\n      name: 'home',\n      component: home\n    }\n  ]\n});\n\n// 导航守卫\n\n// 使用 router.beforeEach 注册一个全局前置守卫，判断用户是否登陆\n\nrouter.beforeEach((to, from, next) => {\n  if (to.path === '/login') {\n    next();\n  } else {\n    let token = localStorage.getItem('Authorization');\n    if (token === 'null' || token === '') {\n      next('/login');\n    } else {\n      next();\n    }\n  }\n});\n\nexport default router\n")])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br"),a("span",{staticClass:"line-number"},[n._v("6")]),a("br"),a("span",{staticClass:"line-number"},[n._v("7")]),a("br"),a("span",{staticClass:"line-number"},[n._v("8")]),a("br"),a("span",{staticClass:"line-number"},[n._v("9")]),a("br"),a("span",{staticClass:"line-number"},[n._v("10")]),a("br"),a("span",{staticClass:"line-number"},[n._v("11")]),a("br"),a("span",{staticClass:"line-number"},[n._v("12")]),a("br"),a("span",{staticClass:"line-number"},[n._v("13")]),a("br"),a("span",{staticClass:"line-number"},[n._v("14")]),a("br"),a("span",{staticClass:"line-number"},[n._v("15")]),a("br"),a("span",{staticClass:"line-number"},[n._v("16")]),a("br"),a("span",{staticClass:"line-number"},[n._v("17")]),a("br"),a("span",{staticClass:"line-number"},[n._v("18")]),a("br"),a("span",{staticClass:"line-number"},[n._v("19")]),a("br"),a("span",{staticClass:"line-number"},[n._v("20")]),a("br"),a("span",{staticClass:"line-number"},[n._v("21")]),a("br"),a("span",{staticClass:"line-number"},[n._v("22")]),a("br"),a("span",{staticClass:"line-number"},[n._v("23")]),a("br"),a("span",{staticClass:"line-number"},[n._v("24")]),a("br"),a("span",{staticClass:"line-number"},[n._v("25")]),a("br"),a("span",{staticClass:"line-number"},[n._v("26")]),a("br"),a("span",{staticClass:"line-number"},[n._v("27")]),a("br"),a("span",{staticClass:"line-number"},[n._v("28")]),a("br"),a("span",{staticClass:"line-number"},[n._v("29")]),a("br"),a("span",{staticClass:"line-number"},[n._v("30")]),a("br"),a("span",{staticClass:"line-number"},[n._v("31")]),a("br"),a("span",{staticClass:"line-number"},[n._v("32")]),a("br"),a("span",{staticClass:"line-number"},[n._v("33")]),a("br"),a("span",{staticClass:"line-number"},[n._v("34")]),a("br"),a("span",{staticClass:"line-number"},[n._v("35")]),a("br"),a("span",{staticClass:"line-number"},[n._v("36")]),a("br"),a("span",{staticClass:"line-number"},[n._v("37")]),a("br"),a("span",{staticClass:"line-number"},[n._v("38")]),a("br"),a("span",{staticClass:"line-number"},[n._v("39")]),a("br"),a("span",{staticClass:"line-number"},[n._v("40")]),a("br"),a("span",{staticClass:"line-number"},[n._v("41")]),a("br"),a("span",{staticClass:"line-number"},[n._v("42")]),a("br")])]),a("h2",{attrs:{id:"三、请求头加token-在-main-js中添加"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#三、请求头加token-在-main-js中添加"}},[n._v("#")]),n._v(" 三、请求头加token  在 main.js中添加")]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v("// 添加请求拦截器，在请求头中加token\n\naxios.interceptors.request.use(\n  config => {\n    if (localStorage.getItem('Authorization')) {\n      config.headers.Authorization = localStorage.getItem('Authorization');\n    }\n    return config;\n  },\n  error => {\n    return Promise.reject(error);\n  });\n")])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br"),a("span",{staticClass:"line-number"},[n._v("6")]),a("br"),a("span",{staticClass:"line-number"},[n._v("7")]),a("br"),a("span",{staticClass:"line-number"},[n._v("8")]),a("br"),a("span",{staticClass:"line-number"},[n._v("9")]),a("br"),a("span",{staticClass:"line-number"},[n._v("10")]),a("br"),a("span",{staticClass:"line-number"},[n._v("11")]),a("br"),a("span",{staticClass:"line-number"},[n._v("12")]),a("br")])]),a("p",[n._v("token的过期可以自定义")]),n._v(" "),a("h2",{attrs:{id:"四、清除token信息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#四、清除token信息"}},[n._v("#")]),n._v(" 四、清除token信息")]),n._v(" "),a("p",[n._v("如果前端拿到状态码为401，就清除token信息并跳转到登录页面")]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v("localStorage.removeItem('Authorization');\nthis.$router.push('/login');\n")])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br")])])])}),[],!1,null,null,null);s.default=t.exports}}]);